# Kerberoasting

**Any** domain user can retrieve a service ticket that is encrypted with the NTLM hash of the service owner in an Active Directory environment. Often the accounts that own a particular service are computer accounts, but are sometimes user accounts (called service accounts). These service accounts are said to be "Kerberoastable." With the hash-encrypted service ticket in hand, you can attempt to crack the encryption offline and use the cracked hash for further access into the environment.

It is possible to enumerate Kerberoastable domain users by finding those whose list of [[service-principal-name|service principal names (SPNs)]] is not null.

![Kerberoasting Flow](kerberoasting.png)

---

## Discover which Users are "Kerberoastable"

On Linux or Windows (collectors for both):
- [[bloodhound#Discover Kerberoastable Users|BloodHound]]

On Linux:
- [[pywerview#Gather Users that are kerberoasting Kerberoastable|pywerview]]
- [[GetUserSPNs#Discover Kerberoastable Users|impacket-GetUserSPNs]]
- [[windapsearch#Enumerate all users with service principal names for kerberoasting|windapsearch]]

---

## Kerberoast a Particular Domain User (credentials required)

- From Linux:
	- [[GetUserSPNs#Retrieve a Service Ticket Encrypted with the Password Hash of a Kerberoastable User|impacket-GetUserSPNs]]
- From Windows
	- [[covenant-kerberoast#Kerberoast a Particular User|From a Covenant Grunt]]

---

## Kerberoast All Kerberoastable Domain Users

- From Linux:
	- [[GetUserSPNs#Retrieve a Service Ticket Encrypted with the Password Hash of all Kerberoastable Users|impacket-GetUserSPNs]]
- From Windows:
	- [[windows/active-directory/tools/rubeus#Kerberoast all Kerberoastable Users|rubeus]]

---

## [[hashcat#Offline dictionary attack against a Service Ticket kerberoasting Kerberoasting|Crack the Service Ticket with Hashcat]]

---

## Add a SPN to a Target Principal

If you have control of a principal that has `GenericAll` or `GenericWrite` access to another principal, you can set a [[service-principal-name|SPN]] on them using [[powerview#Add a SPN To a Principal|PowerView]] and then Kerberoast them.

---

## "Clock skew is too great" impacket error

If you get this error, you need to synchronize your system's time with the time of the domain controller. Two potential methods:

### Method 1: `rdate`

```bash
sudo rdate -n $DOMAIN_CONTROLLER_IP
```

### Method 2: `timedatectl`

1. Figure out the domain controller's time

    ```bash
    $ sudo ntpdate $DOMAIN_CONTROLLER_IP
	14 Jan 19:08:30 ntpdate[16001]: step time server 10.10.10.110 offset 7200.165851 sec
    ```

2. Disable NTP

    ```bash
    sudo timedatectl set-ntp false
    ```

3. Manually set your time to the domain controller's time

    ```bash
    sudo timedatectl set-time $TIME
    ```
	
	- `$TIME` should be in the format `HH:MM:SS`

4. The error should be solved now. Do what you need to do!

5. Reenable NTP to get your time back to its original

    ```bash
    sudo timedatectl set-ntp true
    ```
