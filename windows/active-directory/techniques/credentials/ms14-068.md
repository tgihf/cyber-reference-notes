# [MS14-068](https://docs.microsoft.com/en-us/security-updates/SecurityBulletins/2014/MS14-068)

> A vulnerability in the Microsoft Kerberos implementation present in Windows Server 2003, 2008, 2008 R2, 2012, and 2012 R2. The vulnerability allows an attacker to forge the PAC within a TGT and and receive a service ticket that grants the principal arbitrary privileges, including those of a domain administrator.

---

## Exploit MS14-068 to Elevate a Compromised Domain User to a Domain Administrator from Linux

Begin by ensuring the attacking Linux machine's time and date are synchronized with that of the target domain's domain controller.

```bash
$ sudo rdate -n $DOMAIN_CONTROLLER_FQDN_OR_IP
```

To exploit MS14-068, the following items are needed:

1. Fully qualified domain name (i.e., `marvel.test`)
2. Fully qualified domain name of the domain controller (i.e., `dc01.marvel.test`)
3. The SID of the compromised domain user account who you will be elevating the privileges of
	- [[lookupsid|impacket-lookupsid]]
4. Use [pykek](https://github.com/mubix/pykek) to craft a TGT whose PAC specifies the compromised domain user as a domain administrator

```bash
$ cd pykek
$ sudo python2.7 ms14-068.py -u $USERNAME@$DOMAIN -s $SID -p $PASSWORD -d $DOMAIN_CONTROLLER_FQDN
```

- `$USERNAME` is the SAM account name of the compromised domain user account who you are elevating the privileges of
- `$DOMAIN` is the FQDN of the domain (i.e., `marvel.test`)
- `$SID` is the SID of the compromised domain user account who you are elevating the privileges of
- `$DOMAIN_CONTROLLER_FQDN` the FQDN fo the domain controller (i.e., `dc01.marvel.test`)

Highly recommend ensuring both `$DOMAIN` and `$DOMAIN_CONTROLLER_FQDN` are mapped to the target domain controller in the local DNS resolver.

5. Once you've successfully crafted the TGT, [[using-kerberos-tickets|import and use it]].

---

## References

[TrustedSec's Excellent Writeup](https://www.trustedsec.com/blog/ms14-068-full-compromise-step-step/)
