# Cross-Origin Resource Sharing (CORS)

Cross-origin resource sharing (CORS) is an HTTP-header based mechanism that allows a server to indicate any [[same-origin-policy#What is an origin|origins]] other than its own from which a browser should permit loading resources. It serves as a mechanism by which web application developers can relax the [[same-origin-policy|same origin policy (SOP)]].

CORS relies on a mechanism by which the browser, before sending a **non-**[[same-origin-policy#What is a simple request|simple request]], first makes a [[cross-origin-resource-sharing#Preflight Request|preflight request]] to the server hosting the cross-origin resource, in order to check that the server will permit the actual request.

---

## How Simple Requests Work

When the browser makes a [[same-origin-policy#What is a simple request|simple request]], it includes the `Origin` HTTP header whose value is the [[same-origin-policy#What is an origin|origin]] the request is originating from. In the server's response will be the `Access-Control-Allow-Origin` header, which contains a glob pattern for which origins are allowed to access resources from it. If the `Origin` doesn't match the `Access-Control-Allow-Origin` pattern, the browser will return an error.

---

## How Non-Simple Requests Work

### Preflight Request

Before the browser makes a **non-**[[same-origin-policy#What is a simple request|simple request]] to a cross-origin resource, it will first send a **preflight request** to the server hosting the cross-origin resource in order to check that the server will permit the actual request.

The preflight request uses the HTTP `OPTIONS` method and specifies the `Origin`, `Access-Control-Request-Method`, and `Access-Control-Request-Headers` headers.

Just like in a [[cross-origin-resource-sharing#How Simple Requests Work|simple request]], the value of the `Origin` header is the [[same-origin-policy#What is an origin|origin]] the request is originating from. For example, if the request is generated by a script served by `https://tgihf.click`, then the `Origin` value will be `https://tgihf.click`.

The value of the `Access-Control-Request-Method` header is the HTTP method that will be sent with the actual request. For example, if the request is sent with with the `POST` method, then the `Access-Control-Request-Method` value will be `POST`.

The value of the `Access-Control-Request-Headers` header is a comma-separated list of custom headers the actual request will be sent with. For example, if the request is sent with the `X-Whatever` and `Content-Type` headers set manually, then the `Access-Control-Request-Headers` value will be `X-Whatever, Content-Type`.

### Preflight Response

The response to the preflight request will often be an HTTP 204 "No Content" code. It will contain the `Access-Control-Allow-Origin`, `Access-Control-Allow-Methods`, and `Access-Control-Allow-Headers` headers.

Similar to the response from a [[cross-origin-resource-sharing#How Simple Requests Work|simple request]], the `Access-Control-Allow-Origin` header contains a glob pattern for which origins are allowed to access the resource in question. If the `Origin` in the preflight request doesn't match this pattern, the browser will return an error.

The value of the `Acces-Control-Allow-Methods` header is a comma-separated list of HTTP methods that are allowed when querying the resource in question. If the `Access-Control-Request-Method` in the preflight request isn't in this list, the browser will return an error.

The value of the `Access-Control-Allow-Headers` header is a comma-separated list of HTTP headers that can be manually set in a query to the resource in question. If the `Access-Control-Request-Headers` list isn't a subset of this list, the browser will return an error.

[MDN's CORS article](https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS) describes this process in detail with an example.

---

## References

[MDN - Cross-Origin Resource Sharing (CORS)](https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS)
